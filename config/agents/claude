#!/bin/bash
# Claude Code wrapper script
# Copies ~/AGENT.md and settings.local.json to current directory, then starts Claude Code

# Copy AGENT.md from home directory to current directory as CLAUDE.md
if [ ! -f ./CLAUDE.md ]; then
    cp /opt/AGENT.md ./CLAUDE.md
fi

# Copy settings.local.json from home directory to current directory's .claude folder
if [ ! -f ./.claude/settings.local.json ]; then
    mkdir -p ./.claude
    cp /opt/jovyan_defaults/.claude/settings.local.json ./.claude/settings.local.json    
fi


# Start Claude Code from the standard user-local path.
CLAUDE_BIN="${HOME}/.local/bin/claude"
DEFAULT_CLAUDE_BIN="/opt/jovyan_defaults/.local/bin/claude"

if [ ! -x "${CLAUDE_BIN}" ] && [ -x "${DEFAULT_CLAUDE_BIN}" ]; then
    mkdir -p "${HOME}/.local/bin" 2>/dev/null || true
    cp -p "${DEFAULT_CLAUDE_BIN}" "${CLAUDE_BIN}" 2>/dev/null || true
fi

if [ ! -x "${CLAUDE_BIN}" ]; then
    echo "Claude binary not found at ${CLAUDE_BIN}. Restore from ${DEFAULT_CLAUDE_BIN} also failed." >&2
    exit 127
fi

exec "${CLAUDE_BIN}" --allow-dangerously-skip-permissions "$@"
